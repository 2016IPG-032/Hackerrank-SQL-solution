Select c.Contest_ID, hacker_id, name, SUM(ISNULL(total_views,0)) as total_views,SUM(ISNULL(total_unique_views,0)) as total_unique_views into #View from Contests c inner join Colleges coll on coll.Contest_ID = c.Contest_ID inner join Challenges ch on ch.College_ID = coll.College_ID left join View_Stats v on v.Challenge_ID = ch.Challenge_ID group by c.Contest_ID, hacker_id, name
Select c.Contest_ID, hacker_id, name, SUM(ISNULL(total_submissions,0)) as total_submissions ,SUM(ISNULL(total_accepted_submissions,0)) as total_accepted_submissions into #Submissions from Contests c inner join Colleges coll on coll.Contest_ID = c.Contest_ID inner join Challenges ch on ch.College_ID = coll.College_ID left join Submission_Stats s on s.Challenge_ID = ch.Challenge_ID group by c.Contest_ID, hacker_id, name
Select v.Contest_ID, v.hacker_id, v.name,total_submissions,total_accepted_submissions,total_views,total_unique_views into #temp from #View v inner join #Submissions s on s.Contest_ID = v.Contest_ID
Select * from #temp t1 where not exists (Select 1 from #temp t where total_submissions = 0 and total_accepted_submissions = 0 and total_views = 0 and total_unique_views = 0 and t1.Contest_ID = t.Contest_ID) order by t1.Contest_ID
drop table #View drop table #Submissions drop table #temp
